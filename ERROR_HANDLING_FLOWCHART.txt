================================================================================
ERROR HANDLING ISSUES - VISUAL FLOWCHART & RELATIONSHIPS
================================================================================

ISSUE DEPENDENCY TREE
────────────────────────────────────────────────────────────────────────────

                         USER ACTION
                              │
                    ┌─────────┴──────────┐
                    │                    │
               CLI COMMAND        DAEMON POLL CYCLE
                    │                    │
        ┌───────────┴───────────┐        │
        │                       │        │
    [ISSUE 1]             [ISSUE 9]      │
    Exception         Unsupported     [ISSUE 2]
    Swallowing        Format Log      Investigation
    (6 locations)      Missing         Failure
                                    (Silent)
    Returns dict           │
    instead of       Log warning      │
    propagating       at INFO       Continue as if
         │            level          successful
         │                │
    Error lost       Input not                │
    at this level    tracked          ┌───────┘
                                      │
              ┌──────────────────────┐│┌──────────────┐
              │                      ││              │
           CLAUDE CODE         INVESTIGATION    Store/Telemetry
           DIAGNOSIS           CONTINUES         Updates
              │                    │              │
        ┌─────┴─────┐              │         ┌────┴────┐
        │           │              │         │         │
    [ISSUE 3]  [ISSUE 4]           │     [ISSUE 5]  [ISSUE 6]
    Unsafe JSON  Exception      Signature  Stack      Inconsistent
    Parsing      Re-wrapping    remains    Parsing    Exception
    (Loop skip)  (Context lost) undiagnosed silent    Handling
                                              │
         │         │              │           │         │
    Output lost  Original        No retry     No logs  Catches
    Truncated    exception       logic        Debug    broad
    (200 chars)  chain           in place     level    Exception
                                                │
         │         │              │           │         │
    ┌────────────────────────────────────────────────────┘
    │
    RESULT: Investigation fails but daemon continues
            System appears healthy while diagnosis stops
            Administrators unaware diagnosis is broken
            Signatures remain in "investigating" state

════════════════════════════════════════════════════════════════════════════

ERROR PROPAGATION PATHS
────────────────────────────────────────────────────────────────────────────

CORRECT PATH (What should happen):
    
    Exception in underlying service
           │
           ├─ Logged with context
           │
           ├─ Propagated to caller
           │
           ├─ Caller decides: retry/fail/fallback
           │
           └─ Error visible to monitoring/alerting


BROKEN PATH (What currently happens in 3 CRITICAL issues):

    Exception in underlying service
           │
           ├─ [ISSUE 1/2/3: Caught and swallowed]
           │
           ├─ Maybe logged (maybe not)
           │
           ├─ NOT propagated to caller
           │
           ├─ Caller continues normally
           │
           └─ Error invisible to monitoring/alerting


════════════════════════════════════════════════════════════════════════════

FILE-BASED IMPACT ANALYSIS
────────────────────────────────────────────────────────────────────────────

/workspace/rounds/adapters/cli/commands.py
├─ [ISSUE 1: CRITICAL] mute_signature()              - Line 50
├─ [ISSUE 1: CRITICAL] resolve_signature()           - Line 100
├─ [ISSUE 1: CRITICAL] retriage_signature()          - Line 146
├─ [ISSUE 1: CRITICAL] get_signature_details()       - Line 189
├─ [ISSUE 1: CRITICAL] list_signatures()             - Line 288
├─ [ISSUE 1: CRITICAL] reinvestigate_signature()     - Line 355
└─ [ISSUE 9: MEDIUM] unsupported_format handling     - Line 208, 324

/workspace/rounds/adapters/scheduler/daemon.py
├─ [ISSUE 2: CRITICAL] investigation cycle           - Line 137
└─ [ISSUE 8: MEDIUM] budget exceeded handling        - Line 112

/workspace/rounds/adapters/diagnosis/claude_code.py
├─ [ISSUE 3: CRITICAL] JSON parsing loop             - Line 210
└─ [ISSUE 4: HIGH] exception re-wrapping             - Line 223

/workspace/rounds/adapters/store/sqlite.py
└─ [ISSUE 6: HIGH] exception handling in _row_to_signature() - Line 385

/workspace/rounds/adapters/notification/markdown.py
├─ [ISSUE 7: HIGH] report() IOError handling         - Line 52
└─ [ISSUE 7: HIGH] report_summary() IOError handling - Line 72

/workspace/rounds/adapters/telemetry/grafana_stack.py
└─ [ISSUE 5: HIGH] stack frame parsing               - Line 256


════════════════════════════════════════════════════════════════════════════

ERROR CATEGORIES ACROSS CODEBASE
────────────────────────────────────────────────────────────────────────────

SILENT FAILURES (Errors caught but not visible):
    ├─ [ISSUE 1] CLI: Exception → dict (6 locations)
    ├─ [ISSUE 2] Daemon: Investigation silently fails
    ├─ [ISSUE 3] Claude Code: JSON parsing loop skips
    └─ [ISSUE 5] Telemetry: Stack parsing returns []

INADEQUATE CONTEXT (Missing information for debugging):
    ├─ [ISSUE 3] Claude Code: Output truncated 200→500 chars
    ├─ [ISSUE 4] Claude Code: Exception re-wrapping loses chain
    ├─ [ISSUE 7] Notifications: IOError missing errno/operation
    └─ [ISSUE 9] CLI: Format errors not logged at all

INCONSISTENT HANDLING (Same error type handled differently):
    ├─ [ISSUE 2] Daemon: All errors treated as "error"
    ├─ [ISSUE 5] Telemetry: Debug level too low
    ├─ [ISSUE 6] Store: Broad Exception catches too much
    └─ [ISSUE 8] Daemon: Budget exhaustion not special-cased


════════════════════════════════════════════════════════════════════════════

SEVERITY ASSESSMENT SCALE
────────────────────────────────────────────────────────────────────────────

CRITICAL (3 issues): Affects core system reliability
    - Exception propagation broken
    - Diagnosis fails silently
    - Core feature (JSON parsing) unsafe
    → Must fix before any production use

HIGH (4 issues): Affects debugging and reliability
    - Error context lost
    - Partial data loss without notification
    - Inconsistent error handling
    → Should fix before merge

MEDIUM (2 issues): Nice-to-have improvements
    - Enhanced logging
    - Better error messages
    → Can address before production


════════════════════════════════════════════════════════════════════════════

SAMPLE FAILURE SCENARIOS THAT GO UNNOTICED
────────────────────────────────────────────────────────────────────────────

Scenario 1: Database Connection Failure
    1. Daemon polls for errors
    2. Store adapter fails to connect
    3. [ISSUE 1 if via CLI] Error swallowed, returns {"status": "error"}
    4. [ISSUE 2 if in daemon] Error logged but continues
    5. Result: Signatures not retrieved, no errors surface
    6. Admin sees: Daemon running normally, "checking logs" shows no recent activity
    7. What they miss: Database has been unreachable for hours

Scenario 2: Claude Code API Rate Limited
    1. Diagnosis requested
    2. Claude Code API returns 429 (rate limited)
    3. [ISSUE 3] JSON parsing sees non-JSON response
    4. Loop skips the line, raises "no valid JSON" error
    5. Error logged but investigation cycle continues
    6. Result: Diagnosis fails silently, signature not diagnosed
    7. Admin sees: Investigation cycle ran, completed 0 diagnoses
    8. What they miss: Should have backed off and retried

Scenario 3: Stack Trace Parsing Fails
    1. Error event arrives with malformed stack trace
    2. [ISSUE 5] Parsing fails, logs at DEBUG level
    3. Returns empty stack_frames list
    4. Investigation context incomplete
    5. Diagnosis has no stack information to analyze
    6. Result: Poor quality diagnosis due to missing context
    7. Admin sees: Diagnosis completed with low confidence
    8. What they miss: Root cause was missing stack information

Scenario 4: Signature Not Found Error
    1. User mutes signature via CLI
    2. [ISSUE 1] Management port raises ValueError
    3. CLI catches and returns {"status": "error", "message": "..."}
    4. User's script checks if status == "success"
    5. Script continues as if operation succeeded
    6. Result: Signature never muted, error invisible
    7. Admin sees: Signature still raising alerts
    8. What they miss: User's mute attempt was never executed


════════════════════════════════════════════════════════════════════════════

FIX IMPACT VISUALIZATION
────────────────────────────────────────────────────────────────────────────

Before Fix (Current State):
    
    Exception
        │
        ├─ [Caught]
        ├─ [Logged or not]
        ├─ [Swallowed]
        └─ System continues
            └─ ❌ Error invisible
            └─ ❌ No visibility for admins
            └─ ❌ Monitoring can't alert
            └─ ❌ Debugging is impossible


After Fix (Desired State):
    
    Exception
        │
        ├─ [Logged with context]
        ├─ [Categorized by type]
        ├─ [Propagated appropriately]
        └─ Caller decides action
            ├─ Retry transient → ✓ Auto-recovery
            ├─ Fail permanent → ✓ Visible error
            ├─ Fallback known → ✓ Graceful degradation
            └─ Monitor alert → ✓ Admin notified


════════════════════════════════════════════════════════════════════════════

END OF FLOWCHART
════════════════════════════════════════════════════════════════════════════
